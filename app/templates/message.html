<!DOCTYPE html>
<html>
  <head>
    <title>Direct Messaging App</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
    <script type="text/javascript">
      var socket = io.connect('http://' + document.domain + ':' + location.port);

      $(document).ready(function() {
        $('form#login').submit(function(event) {
          socket.emit('join', {'username': $('input#username').val()});
          return false;
        });

        $('form#chat').submit(function(event) {
          socket.emit('send_message', {'message': $('input#message').val(), 'recipient_username': $('input#recipient').val()});
          $('input#message').val('').focus();
          return false;
        });

        socket.on('message', function(data) {
          $('#messages').append('<div class="message"><strong>' + data.username + ': </strong>' + data.message + '</div>');
        });
      });
    </script>
    <style type="text/css">
      .message { margin-bottom: 10px; }
    </style>
  </head>
  <body>
    {% if username %}
      <h1>Welcome, {{ username }}!</h1>
      <form id="chat" method="post">
        <label for="recipient">Recipient:</label>
        <input type="text" id="recipient" name="recipient" required>
        <br><br>
        <label for="message">Message:</label>
        <input type="text" id="message" name="message" required>
        <input type="submit" value="Send">
      </form>
      <hr>
      <h2>Chat</h2>
      <div id="messages"></div>
    {% else %}
      <h1>Direct Messaging App</h1>
      <form id="login" method="post">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
        <input type="submit" value="Log in">
      </form>
    {% endif %}
  </body>
</html>
